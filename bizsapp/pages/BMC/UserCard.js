import styles from '../../styles/BMC.module.css';
import { FontAwesomeIcon } from "@fortawesome/react-fontawesome";
import { faAngleRight, faAngleLeft, faEnvelope, faGlobe, faLocationDot } from "@fortawesome/free-solid-svg-icons";
import { faYoutube, faFacebook, faTwitter, faInstagram, faLinkedin } from "@fortawesome/free-brands-svg-icons";
import { useState } from 'react';
import Image from "next/image";
import Link from "next/link";
import Head from 'next/head'
import * as React from "react";
import { ObjectId } from "mongodb";
import { pageURL } from "../../utils/PageURL";





import { connectToDatabase } from "../../lib/mongodb";

export default function UserCard({ properties, userData }) {




    return (

        <>




            {properties && properties.map(properties => {


                const [active, setActive] = useState(false);


                const [copied, setCopied] = useState(false);
                function copy() {
                    const el = document.createElement("input");
                    el.value = window.location.href;
                    document.body.appendChild(el);
                    document.body.appendChild(el);
                    el.select();
                    document.execCommand("copy");
                    document.body.removeChild(el);
                    setCopied(true);
                }



                return (
                    <>

                        <Head>
                            <title>BMC | Business Management Card</title>
                            <meta name="description" content="Generated by Bizsapp" />
                            <link rel="icon" href="/favicon.ico" />
                            <meta name="msapplication-TileImage" content={properties.brandLogo} />
                            <meta property="og:site_name" content={properties.brandName} />
                            <meta property="og:BMC" content={properties.businessName} />
                            <meta property="og:title Card" content="Business Managment Card" />
                            <meta property="og:image" itemprop="image" content={properties.brandLogo} />

                            <meta property="og:type" content="website" />
                            <meta property="og:image:type" content="image/png" />

                            <meta property="og:image:width" content="300" />
                            <meta property="og:image:height" content="300" />

                            <meta property="og:url" content="https://bizsapp.com/" />
                        </Head>

                        <section className="container-fluid p-0">
                            <div className={styles.bmc_box}>
                                <div className={styles.flip_card}>
                                    <div className={active ? `${styles.card} ${styles.active}` : styles.card}>
                                        <div className={`${styles.card__face} ${styles.card__face_front}`}>

                                            <div className={styles.card_header}>
                                                <p>Business Management Card</p>
                                                <div className={styles.company_logo}>
                                                    <img src={properties.brandLogo} className="img-fluid" />
                                                </div>
                                            </div>

                                            <div className={styles.company_about}>
                                                <div>
                                                    <div className={styles.company_name}>
                                                        <h1>{properties.brandName}</h1>
                                                    </div>
                                                    <div className={styles.card_holder_name}>
                                                        <i>{properties.businessName}</i>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className={styles.detail_box}>
                                                <div className={`${styles.social_link} ${styles.social_link_box}`}>
                                                    {/* {console.log('properties.socialLinks.link', properties.socialLinks.link)} */}

                                                    <ul>

                                                        {properties.socialLinks[0].socialLinkType === "Facebook" && properties.socialLinks[0].link !== " " ?

                                                            <a href={properties.socialLinks[0].link}>
                                                                <li>
                                                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M279.14 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z" /></svg>
                                                                </li>
                                                            </a>

                                                            :

                                                            <li className={styles.disable}>
                                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M279.14 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z" /></svg>
                                                            </li>

                                                        }

                                                        {properties.socialLinks[1].socialLinkType === "Instagram" && properties.socialLinks[1].link !== " " ?

                                                            <a href={properties.socialLinks[1].link}>
                                                                <li>
                                                                    <FontAwesomeIcon icon={faInstagram} />
                                                                </li>
                                                            </a>

                                                            :

                                                            <li className={styles.disable}>
                                                                <FontAwesomeIcon icon={faInstagram} />
                                                            </li>

                                                        }

                                                        {properties.socialLinks[2].socialLinkType === "Youtube" && properties.socialLinks[2].link !== " " ?

                                                            <a href={properties.socialLinks[2].link}>
                                                                <li>
                                                                    <FontAwesomeIcon icon={faYoutube} />
                                                                </li>
                                                            </a>

                                                            :

                                                            <li className={styles.disable}>
                                                                <FontAwesomeIcon icon={faYoutube} />
                                                            </li>

                                                        }

                                                        {properties.socialLinks[3].socialLinkType === "LinkedIn" && properties.socialLinks[3].link !== " " ?

                                                            <a href={properties.socialLinks[3].link}>
                                                                <li>
                                                                    <FontAwesomeIcon icon={faLinkedin} />
                                                                </li>
                                                            </a>

                                                            :

                                                            <li className={styles.disable}>
                                                                <FontAwesomeIcon icon={faLinkedin} />
                                                            </li>

                                                        }

                                                        {properties.socialLinks[4].socialLinkType === "Twitter" && properties.socialLinks[4].link !== " " ?

                                                            <a href={properties.socialLinks[4].link}>
                                                                <li>
                                                                    <FontAwesomeIcon icon={faTwitter} />
                                                                </li>
                                                            </a>

                                                            :

                                                            <li className={styles.disable}>
                                                                <FontAwesomeIcon icon={faTwitter} />
                                                            </li>

                                                        }



                                                    </ul>
                                                </div>



                                                <div className={styles.detail_text_effect_shadow}>
                                                    <Image src="/img/icons/shadow.png" width={139} height={27} alt="detail_shadow" />
                                                </div>
                                                <div className={styles.detail_text_effect}>
                                                    Details
                                                </div>
                                            </div>

                                            <div className={styles.detail_box_days}>
                                                <div className={styles.businessBtn}>Business Days</div>
                                                <div className={`${styles.business_day}`}>
                                                    <ul>

                                                        {/* {properties.businessDays.map((curElt) => {
                                                            return (
                                                                <>
                                                                    <li><p>{curElt.substr(0, 3)}</p></li>
                                                                </>
                                                            )
                                                        })} */}

                                                        {/* {properties.businessDays.includes(days) === days ? (<><li><p>{curElt.substr(0, 3)}</p></li></>) : (<><li clasName={styles.disable}><p>{curElt.substr(0, 3)}</p></li></>)}
                                                        console.log(days) */}

                                                        

                                                        {properties.businessDays.includes('monday') ?

                                                            (
                                                                <>
                                                                    <li><p>MON</p></li>
                                                                </>
                                                            )

                                                            :

                                                            (
                                                                <>
                                                                    <li className={styles.disable}><p>MON</p></li>
                                                                </>
                                                            )

                                                        }

                                                        {properties.businessDays.includes('tuesday') ?

                                                            (
                                                                <>
                                                                    <li><p>TUS</p></li>
                                                                </>
                                                            )

                                                            :

                                                            (
                                                                <>
                                                                    <li className={styles.disable}><p>TUS</p></li>
                                                                </>
                                                            )

                                                        }

                                                        {properties.businessDays.includes('wednesday') ?

                                                            (
                                                                <>
                                                                    <li><p>WED</p></li>
                                                                </>
                                                            )

                                                            :

                                                            (
                                                                <>
                                                                    <li className={styles.disable}><p>WED</p></li>
                                                                </>
                                                            )

                                                        }


                                                        {properties.businessDays.includes('thursday') ?

                                                            (
                                                                <>
                                                                    <li><p>THU</p></li>
                                                                </>
                                                            )

                                                            :

                                                            (
                                                                <>
                                                                    <li className={styles.disable}><p>THU</p></li>
                                                                </>
                                                            )

                                                        }

                                                        {properties.businessDays.includes('friday') ?

                                                            (
                                                                <>
                                                                    <li><p>FRI</p></li>
                                                                </>
                                                            )

                                                            :

                                                            (
                                                                <>
                                                                    <li className={styles.disable}><p>FRI</p></li>
                                                                </>
                                                            )

                                                        }

                                                        {properties.businessDays.includes('saturday') ?

                                                            (
                                                                <>
                                                                    <li><p>SAT</p></li>
                                                                </>
                                                            )

                                                            :

                                                            (
                                                                <>
                                                                    <li className={styles.disable}><p>SAT</p></li>
                                                                </>
                                                            )

                                                        }

                                                        {properties.businessDays.includes('sunday') ?

                                                            (
                                                                <>
                                                                    <li><p>SUN</p></li>
                                                                </>
                                                            )

                                                            :

                                                            (
                                                                <>
                                                                    <li className={styles.disable}><p>SUN</p></li>
                                                                </>
                                                            )

                                                        }

                                                    </ul>
                                                </div>
                                            </div>

                                            <div className={styles.enquiry_box}>
                                                <ul>
                                                    {properties.email &&
                                                        <li>
                                                            <div className={styles.enquiry_box_content}>
                                                                <div>
                                                                    <FontAwesomeIcon icon={faEnvelope} />
                                                                </div>
                                                                <div>
                                                                    {properties.email}
                                                                </div>
                                                            </div>
                                                            <div className={styles.enquiry_box_content}>
                                                                <a href={"mailto:" + properties.email}>
                                                                    <button> Send Mail</button>
                                                                </a>
                                                            </div>
                                                        </li>
                                                    }

                                                    {properties.websiteLink &&
                                                        <li>
                                                            <div className={styles.enquiry_box_content}>
                                                                <div>
                                                                    <FontAwesomeIcon icon={faGlobe} />
                                                                </div>
                                                                <div>
                                                                    {properties.websiteLink}
                                                                </div>
                                                            </div>
                                                            <div className={styles.enquiry_box_content}>
                                                                <a href={properties.websiteLink} target="_blank">
                                                                    <button>Visit Website</button>
                                                                </a>
                                                            </div>
                                                        </li>
                                                    }


                                                    {properties.address &&
                                                        <li>
                                                            <div className={styles.enquiry_box_content}>
                                                                <div>
                                                                    <FontAwesomeIcon icon={faLocationDot} />
                                                                </div>
                                                                <div>
                                                                    {properties.address}
                                                                </div>
                                                            </div>
                                                            <div className={styles.enquiry_box_content}>
                                                                <a href="#">
                                                                    <button> Location</button>
                                                                </a>
                                                            </div>
                                                        </li>
                                                    }

                                                </ul>
                                            </div>

                                            <div className={`${styles.business_card_footer} ${styles.business_card_footer_back}`}>
                                                <div className={styles.business_card_footer_button}>
                                                    <a href={"tel:+91" + properties.contacts[0].contactNumber}>
                                                        <img src="/img/icons/bmc-call.png" alt='call_icon' />
                                                    </a>
                                                </div>
                                                <div className={styles.business_card_footer_button}>
                                                    <a href="#">
                                                        <img src="/img/icons/bmc-chat.png" alt='chat_icon' className={styles.bmc_chat} />
                                                    </a>
                                                </div>
                                                <div className={styles.business_card_footer_button}>
                                                    {/* <Link href="https://wa.me/919910067051?text=Hello Digrowfa ">
                                                        
                                                    </Link> */}
                                                    <a href={"https://wa.me/+91" + properties.contacts[1].contactNumber + "?text=Hello " + properties.businessName} >
                                                        <img src="/img/icons/bmc-whatsapp.png" alt='whatsapp_icon' />
                                                    </a>
                                                </div>
                                                <div className={styles.business_card_footer_button}>
                                                    <a href="#">
                                                        <img src="/img/icons/bmc-share.png" alt='share_icon' data-bs-toggle="offcanvas" data-bs-target="#offcanvasBottom" aria-controls="offcanvasBottom" />
                                                    </a>
                                                </div>
                                            </div>

                                            <div className={styles.clickButton} onClick={() => setActive(!active)}>
                                                <FontAwesomeIcon icon={faAngleRight} />
                                            </div>
                                        </div>
                                        <div className={`${styles.card__face} ${styles.card__face_back}`}>



                                            {/* {properties.brandVideo ? (

                                                <>
                                                    <div className={styles.backCard_name}>
                                                        <p>Business Management Card</p>
                                                    </div>

                                                    <div className={styles.video_box}>
                                                        <video controls>
                                                            <source src={properties.brandVideo} type="video/mp4" />
                                                            Your browser does not support the video tag.
                                                        </video>
                                                    </div>

                                                    <div className={styles.video_title}>
                                                        <h2>This is title of video</h2>
                                                    </div>

                                                    {userData && userData.map(userData => {

                                                        return (
                                                            <>
                                                                <div className={styles.userProfileBox}>
                                                                    <div className={styles.userProfile}>
                                                                        <img src={userData.profilepic} alt="Profile_Pic" className='img-fluid' />
                                                                    </div>
                                                                    <div className={styles.userName}>
                                                                        <h2>{userData.name}</h2>
                                                                    </div>
                                                                    <div className={styles.userTitle}>
                                                                        <p>{userData.title}</p>
                                                                    </div>
                                                                    <div className={styles.profileButton}>
                                                                        <button>View Profile</button>
                                                                    </div>
                                                                </div>
                                                            </>
                                                        )
                                                    })}

                                                    <div className={styles.backFooter}>
                                                        <div className={styles.business_card_footer}>
                                                            <div className={styles.business_card_footer_button}>
                                                                <Link href={"tel:+91" + properties.contacts[0].contactNumber}>
                                                                    <Image src="/img/icons/call.png" alt='call_icon' width={27} height={27} />
                                                                </Link>
                                                            </div>
                                                            <div className={styles.business_card_footer_button}>
                                                                <Link href="#">
                                                                    <Image src="/img/icons/chat.png" alt='chat_icon' width={27} height={27} />
                                                                </Link>
                                                            </div>
                                                            <div className={styles.business_card_footer_button}>
                                                               
                                                                <a href={"https://wa.me/+91" + properties.contacts[1].contactNumber + "?text=Hello " + properties.businessName} >
                                                                    <Image src="/img/icons/whatsapp.png" alt='whatsapp_icon' width={27} height={27} />
                                                                </a>
                                                            </div>
                                                            <div className={styles.business_card_footer_button}>
                                                                <Link href="#">
                                                                    <Image src="/img/icons/share.png" alt='share_icon' width={27} height={27} data-bs-toggle="offcanvas" data-bs-target="#offcanvasBottom" aria-controls="offcanvasBottom" />
                                                                </Link>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div className={styles.contactTitle}>
                                                        <h2>Contact with me on <span>BizsApp</span></h2>
                                                    </div>

                                                </>

                                            ) :
                                                (
                                                    <div className={styles.card_video_logo}>
                                                        <div className={styles.card_back_logo_outline}>
                                                            <div className={styles.card_back_logo}>
                                                                <Image src="/img/ecard/bizsapp-logo.svg" alt='BizsApp' width={151} height={140} />
                                                            </div>
                                                        </div>
                                                    </div>
                                                )

                                            } */}

                                            <div className={styles.backCard_name}>
                                                <p>Business Management Card</p>
                                            </div>
                                            {userData && userData.map(userData => {

                                                return (
                                                    <>
                                                        <div className={styles.userProfileBox}>
                                                            <div className={styles.userProfile}>
                                                                <img src={userData.profilepic} alt="Profile_Pic" className='img-fluid' />
                                                            </div>
                                                            <div className={styles.userName}>
                                                                <h2>{userData.name}</h2>
                                                            </div>
                                                            <div className={styles.userTitle}>
                                                                <p>{userData.title}</p>
                                                            </div>
                                                            <div className={styles.profileButton}>
                                                                <button>View Profile</button>
                                                            </div>
                                                        </div>
                                                    </>
                                                )
                                            })}

                                            <div className={styles.backFooter}>
                                                <div className={styles.business_card_footer}>
                                                <div className={styles.business_card_footer_button}>
                                                    <a href={"tel:+91" + properties.contacts[0].contactNumber}>
                                                        <img src="/img/icons/bmc-call.png" alt='call_icon' />
                                                    </a>
                                                </div>
                                                <div className={styles.business_card_footer_button}>
                                                    <a href="#">
                                                        <img src="/img/icons/bmc-chat.png" alt='chat_icon' className={styles.bmc_chat} />
                                                    </a>
                                                </div>
                                                <div className={styles.business_card_footer_button}>
                                                    {/* <Link href="https://wa.me/919910067051?text=Hello Digrowfa ">
                                                        
                                                    </Link> */}
                                                    <a href={"https://wa.me/+91" + properties.contacts[1].contactNumber + "?text=Hello " + properties.businessName} >
                                                        <img src="/img/icons/bmc-whatsapp.png" alt='whatsapp_icon' />
                                                    </a>
                                                </div>
                                                <div className={styles.business_card_footer_button}>
                                                    <a href="#">
                                                        <img src="/img/icons/bmc-share.png" alt='share_icon' data-bs-toggle="offcanvas" data-bs-target="#offcanvasBottom" aria-controls="offcanvasBottom" />
                                                    </a>
                                                </div>
                                                </div>
                                            </div>

                                            <div className={styles.contactTitle}>
                                                <h2>Connect with me on <span>BizsApp</span></h2>
                                            </div>
                                            {/* <div className={styles.card_video_logo}>
                                                        <div className={styles.card_back_logo_outline}>
                                                            <div className={styles.card_back_logo}>
                                                                <Image src="/img/ecard/bizsapp-logo.svg" alt='BizsApp' width={151} height={140} />
                                                            </div>
                                                        </div>
                                                    </div> */}



                                            <div className={styles.clickButton} onClick={() => setActive(!active)}>
                                                <FontAwesomeIcon icon={faAngleLeft} />
                                            </div>
                                        </div>
                                    </div>

                                    <div className='card_share_modal'>
                                        <div className="offcanvas offcanvas-bottom" tabIndex="-1" id="offcanvasBottom" aria-labelledby="offcanvasBottomLabel">

                                            <div className="offcanvas-body small">
                                                <div className={styles.share_card_content}>
                                                    <h2>Share Via</h2>

                                                    <div className={styles.share_media}>
                                                        <ul>
                                                            <li>
                                                                <a onClick={copy}>
                                                                    <Image src="/img/cardIcon/copy.png" alt="copy_to_clipboard" width={35} height={35} />
                                                                    <div className={styles.icon_name}>{!copied ? "Copy to clipboard" : "Copied!"}</div>
                                                                </a>
                                                            </li>
                                                            <li>
                                                                <a href={"https://www.facebook.com/sharer/sharer.php?u=https://bizsapp.com?id=" + properties.user}>
                                                                    <Image src="/img/cardIcon/facebook.png" alt="facebook" width={35} height={35} />
                                                                    <div className={styles.icon_name}>
                                                                        Facebook
                                                                    </div>
                                                                </a>
                                                            </li>
                                                            <li>
                                                                <a href={`whatsapp://send?text=${pageURL}${properties.user}`}>
                                                                    <Image src="/img/cardIcon/whatsapp.png" alt="whatsapp" width={35} height={35} />
                                                                    <div className={styles.icon_name}>
                                                                        Whatsapp
                                                                    </div>
                                                                </a>
                                                            </li>
                                                            <li>
                                                                <a href={"https://twitter.com/intent/tweet?url=https://bizsapp.com?id=" + properties.user}>
                                                                    <Image src="/img/cardIcon/twitter.png" alt="twitter" width={35} height={35} />
                                                                    <div className={styles.icon_name}>
                                                                        Twitter
                                                                    </div>
                                                                </a>
                                                            </li>

                                                            <li>
                                                                <a href={"https://www.linkedin.com/sharing/share-offsite/?url=https://bizsapp.com?id=" + properties.user}>
                                                                    <Image src="/img/cardIcon/linkedin.png" alt="linkedin" width={35} height={35} />
                                                                    <div className={styles.icon_name}>
                                                                        Linkedin
                                                                    </div>
                                                                </a>
                                                            </li>
                                                            <li>
                                                                <a href={"https://telegram.me/share/url?url=https://bizsapp.com?id=" + properties.user}>
                                                                    <Image src="/img/cardIcon/telegram.png" alt="telegram" width={35} height={35} />
                                                                    <div className={styles.icon_name}>
                                                                        Telegram
                                                                    </div>
                                                                </a>
                                                            </li>
                                                        </ul>

                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>




                    </>
                )





            })}



        </>
    )

};


// export async function getServerSideProps(context) {
//     const { db } = await connectToDatabase()


//     const data = await db.collection("businesscards").find({}).toArray();

//     const properties = JSON.parse(JSON.stringify(data));




//     return {
//         props: { properties: properties },

//     }

// };

export async function getServerSideProps(context) {

    const id = context.query.id;

    const { db } = await connectToDatabase()

    const data = await db.collection("businesscards").find({ user: ObjectId(id) }).toArray()

    const data2 = await db.collection("users").find({ _id: ObjectId(id) }).toArray()


    const userData = JSON.parse(JSON.stringify(data2));

    const properties = JSON.parse(JSON.stringify(data));

    return {
        props: {
            properties: properties,
            userData: userData
        },
    }


};